# @configure_input@ 
# Copyright (C) 2003 Kevin P. Scannell <scannell@slu.edu>
#
# This is free software; see the file COPYING for copying conditions.  There is
# NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
#

@SET_MAKE@

SHELL = @SHELL@

prefix=@prefix@
exec_prefix = $(prefix)

bindir = $(exec_prefix)/bin
libexecdir = $(exec_prefix)/libexec
datadir = $(prefix)/share
localedir = $(datadir)/locale
PACKAGE_NAME = @PACKAGE_NAME@
TARBALL = @PACKAGE_TARNAME@
pkgdatadir = $(datadir)/$(PACKAGE_NAME)
INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
CC = @CC@
CFLAGS = @CFLAGS@
DEFS = -DLOCALEDIR=\"$(localedir)\" @DEFS@
ECHO = echo
EGREP = @EGREP@
LEX = @LEX@
LEXLIB = @LEXLIB@
LEX_OUTPUT_ROOT = @LEX_OUTPUT_ROOT@
LN_S = @LN_S@
PERL = @PERL@
YACC = @YACC@

configure: configure.ac
	autoconf

Makefile : Makefile.in config.status
	./config.status
	chmod 444 Makefile

config.status: configure
	./config.status --recheck

distclean :
	cd po && $(MAKE) distclean
	$(MAKE) topclean
	rm -f config.log config.status Makefile

topclean :
	$(MAKE) semiclean
	rm -f aparser eparser rparser *.c~

clean :
	cd po && $(MAKE) clean
	$(MAKE) topclean

semiclean :
	rm -f triail.html y.tab.* $(LEX_OUTPUT_ROOT).* aonchiall.y eisceacht.y rialacha.y

webhome = $(HOME)/public_html/$(PACKAGE_NAME)

installhtml :
	$(INSTALL_DATA) cuidiu.html $(webhome)
	$(INSTALL_DATA) eagar.html $(webhome)
	$(INSTALL_DATA) foirm.html $(webhome)
	$(INSTALL_DATA) form.html $(webhome)
	$(INSTALL_DATA) index.html $(webhome)
	$(INSTALL_DATA) iompar.html $(webhome)
	$(INSTALL_DATA) sios.html $(webhome)
	$(INSTALL_DATA) stair.html $(webhome)
	$(INSTALL_DATA) sampla.html $(webhome)

installweb :
	$(MAKE) installhtml
#	$(MAKE) neamhshuim
	$(INSTALL_DATA) gramadoir.dtd $(webhome)/../dtds
	$(INSTALL_DATA) gramadoir.lsm $(webhome)
#	$(INSTALL_DATA) $(HOME)/.neamhshuim $(pkgdatadir)/Neamhshuim
	bash runchoip

triail.html : FORCE
	gram-ga.pl --iomlan --aschod=iso-8859-1 --html --aspell triail > triail.html

maintainer-clean :
	$(MAKE) distclean

ChangeLog : FORCE
	cvs2cl.pl

dist : FORCE
	$(MAKE) ChangeLog
	$(LN_S) gr ../$(TARBALL)
	tar cvhf $(TARBALL).tar -C .. $(TARBALL)/ABOUT-NLS
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/aonchiall.meta.pl
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/cabhair.pl
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/ChangeLog
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/comhshuite.meta.pl
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/config.guess
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/config.rpath
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/config.sub
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/configure
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/configure.ac
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/COPYING
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/count.pl
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/eisceacht.meta.pl
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/gin.meta.pl
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/gramadoir.dtd
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/gramadoir.el
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/Gramadoir.pm.in
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/gramadoir.vim
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/gram.pl
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/Languages-en_us.pm
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/Languages.pm
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/lexbuild
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/Lingua-XX-Gramadoir.t
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/Makefile.in
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/Makefile.PL.in
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/Makefile-xx.in
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/MANIFEST
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/MANIFEST.SKIP
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/po2perl.pl
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/ponc.in.l
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/ponc.in.y
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/README
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/README.perl
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/README-xx
	tar rvhf $(TARBALL).tar -C .. $(TARBALL)/rialacha.meta.pl
	cd po && $(MAKE) dist
	gzip $(TARBALL).tar
	chmod 444 $(TARBALL).tar.gz
	rm -f ../$(TARBALL)

###############################################################################
#                     .IN FILE GRAMMAR/PARSER
###############################################################################


aonchiall.y : ponc.in.y
	cat ponc.in.y | sed "s/_TAIL_MACRO_/result/; s/_RESULT_MACRO_/POSTAG/" > aonchiall.y

eisceacht.y : ponc.in.y
	cat ponc.in.y | sed "s/_TAIL_MACRO_//; /^result/d" > eisceacht.y

rialacha.y : ponc.in.y
	cat ponc.in.y | sed "s/_TAIL_MACRO_/result/; s/_RESULT_MACRO_/MESSAGE | MESSAGEPLUS MESSAGEARG/" > rialacha.y

aparser : aonchiall.y ponc.in.l gettext.h
	$(LEX) ponc.in.l
	$(YACC) -d aonchiall.y
	$(CC) -c $(CFLAGS) $(DEFS) $(LEX_OUTPUT_ROOT).c y.tab.c
	$(CC) -o aparser $(CFLAGS) $(LEX_OUTPUT_ROOT).o y.tab.o $(LEXLIB)

eparser : eisceacht.y ponc.in.l gettext.h
	$(LEX) ponc.in.l
	$(YACC) -d eisceacht.y
	$(CC) -c $(CFLAGS) $(DEFS) $(LEX_OUTPUT_ROOT).c y.tab.c
	$(CC) -o eparser $(CFLAGS) $(LEX_OUTPUT_ROOT).o y.tab.o $(LEXLIB)

rparser : rialacha.y ponc.in.l gettext.h
	$(LEX) ponc.in.l
	$(YACC) -d rialacha.y
	$(CC) -c $(CFLAGS) $(DEFS) $(LEX_OUTPUT_ROOT).c y.tab.c
	$(CC) -o rparser $(CFLAGS) $(LEX_OUTPUT_ROOT).o y.tab.o $(LEXLIB)

poncin : aparser eparser rparser
	@$(ECHO) 'Checking aonchiall-ga.in'
	@cat aonchiall-ga.in | ./aparser
	@$(ECHO) 'Checking eisceacht-ga.in'
	@cat eisceacht-ga.in | ./eparser
	@$(ECHO) 'Checking rialacha-ga.in'
	@cat rialacha-ga.in | ./rparser

###############################################################################

stresstest : FORCE
	@mv stress.out stress.out.ok
	@mv stress.err stress.err.ok
	@./stress
	@if diff stress.err.ok stress.err && diff stress.out.ok stress.out; then $(ECHO) "OK."; rm -f *.ok; else $(ECHO) "Problem."; fi

FORCE :
